<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Mobile Search Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        #console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-error { color: #dc3545; }
        .log-warn { color: #ffc107; }
        .log-info { color: #17a2b8; }
        .log-debug { color: #6c757d; }
        .status-good { color: #28a745; }
        .status-bad { color: #dc3545; }
    </style>
</head>
<body>
    <h1>Site Mobile Search Test</h1>
    
    <div class="test-section">
        <h2>Test Mobile Search on Actual Site</h2>
        <p>This test checks if the mobile search functionality is working on the actual site.</p>
        <button class="test-button" onclick="testSiteMobileSearch()">Test Site Mobile Search</button>
        <button class="test-button" onclick="openSiteInFrame()">Open Site in Frame</button>
        <button class="test-button" onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="test-section">
        <h2>Site Frame</h2>
        <iframe id="site-frame" src="http://localhost:4327/activitypub-mcp/" width="100%" height="400" style="border: 1px solid #ddd; border-radius: 4px;"></iframe>
    </div>

    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output"></div>
    </div>

    <script>
        // Capture console output
        const consoleOutput = document.getElementById('console-output');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };

        function addLogEntry(message, type = 'log') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(entry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalConsole.log.apply(console, args);
            addLogEntry(args.join(' '), 'info');
        };

        console.error = function(...args) {
            originalConsole.error.apply(console, args);
            addLogEntry(args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalConsole.warn.apply(console, args);
            addLogEntry(args.join(' '), 'warn');
        };

        console.info = function(...args) {
            originalConsole.info.apply(console, args);
            addLogEntry(args.join(' '), 'info');
        };

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        function openSiteInFrame() {
            const frame = document.getElementById('site-frame');
            frame.src = 'http://localhost:4327/activitypub-mcp/';
            console.log('Site loaded in frame');
        }

        function testSiteMobileSearch() {
            console.log('Testing mobile search on actual site...');
            
            const frame = document.getElementById('site-frame');
            
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                // Test 1: Check if mobile search elements exist
                console.log('1. Checking mobile search elements...');
                const mobileSearchOverlay = frameDoc.getElementById('mobile-search-overlay');
                const mobileSearchInput = frameDoc.getElementById('mobile-search-input');
                const mobileSearchToggle = frameDoc.querySelector('.mobile-search-toggle');
                
                console.log('Mobile search overlay exists:', !!mobileSearchOverlay);
                console.log('Mobile search input exists:', !!mobileSearchInput);
                console.log('Mobile search toggle exists:', !!mobileSearchToggle);
                
                // Test 2: Check if global functions are available
                console.log('2. Checking global functions...');
                const frameWindow = frame.contentWindow;
                console.log('window.showMobileSearch:', typeof frameWindow.showMobileSearch);
                console.log('window.hideMobileSearch:', typeof frameWindow.hideMobileSearch);
                
                // Test 3: Try to trigger mobile search
                if (mobileSearchToggle) {
                    console.log('3. Testing mobile search toggle click...');
                    mobileSearchToggle.click();
                    
                    setTimeout(() => {
                        const isVisible = mobileSearchOverlay && mobileSearchOverlay.classList.contains('show');
                        console.log('Mobile search overlay visible after click:', isVisible);
                        
                        if (isVisible) {
                            console.log('✅ Mobile search is working correctly!');
                            // Close it
                            if (frameWindow.hideMobileSearch) {
                                frameWindow.hideMobileSearch();
                            }
                        } else {
                            console.log('❌ Mobile search overlay not showing');
                        }
                    }, 500);
                } else {
                    console.log('❌ Mobile search toggle button not found');
                }
                
            } catch (error) {
                console.error('Error accessing frame content:', error);
                console.log('This might be due to CORS restrictions. Try opening the site directly.');
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('Site mobile search test page loaded');
            console.log('Site URL: http://localhost:4327/activitypub-mcp/');
            
            // Wait for frame to load
            const frame = document.getElementById('site-frame');
            frame.addEventListener('load', () => {
                console.log('Site frame loaded successfully');
                setTimeout(() => {
                    console.log('Ready to test mobile search functionality');
                }, 1000);
            });
        });
    </script>
</body>
</html>
